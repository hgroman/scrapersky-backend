# Frontend API Documentation: Direct Submission Endpoints

**Date:** November 17, 2025  
**Version:** 1.0  
**Status:** ✅ Production Ready  
**Backend Commits:** 68d2e70, 9fce378

---

## Overview

Three new endpoints allow users to bypass early workflow stages and submit data directly into the system. All endpoints require JWT authentication.

**Base URL:** `http://localhost:8000` (dev) / `https://api.scrapersky.com` (prod)

---

## Authentication

All endpoints require JWT token in Authorization header:

```http
Authorization: Bearer <jwt_token>
```

**Token Format:** Standard JWT with user claims  
**Token Location:** User session/auth context  
**Error Response (401):** Missing or invalid token

---

## 1. Direct Domain Submission (WO-010)

### Endpoint
```http
POST /api/v3/domains/direct-submit
```

### Purpose
Bypass WF1-WF2 (Google Maps search → Domain discovery). Users can directly submit domain names for sitemap curation.

### Request Body
```json
{
  "domains": ["example.com", "test.org", "another-domain.net"],
  "auto_queue": false
}
```

**Fields:**
- `domains` (array of strings, required): List of domain names to submit
  - Accepts various formats: `example.com`, `www.example.com`, `https://example.com`
  - Backend normalizes all to base domain (e.g., all become `example.com`)
  - Duplicates are automatically removed after normalization
- `auto_queue` (boolean, optional, default: false): 
  - `false`: Domain status = "New" (manual review required)
  - `true`: Domain status = "Submitted" (auto-queued for sitemap analysis)

### Success Response (200)
```json
{
  "submitted_count": 3,
  "domain_ids": [
    "550e8400-e29b-41d4-a716-446655440001",
    "550e8400-e29b-41d4-a716-446655440002",
    "550e8400-e29b-41d4-a716-446655440003"
  ],
  "auto_queued": false,
  "normalized_domains": [
    "example.com",
    "test.org",
    "another-domain.net"
  ]
}
```

**Response Fields:**
- `submitted_count`: Number of domains successfully created
- `domain_ids`: UUIDs of created domain records
- `auto_queued`: Whether domains were auto-queued
- `normalized_domains`: Normalized domain names (what was actually stored)

### Error Responses

**409 Conflict** - Domain already exists:
```json
{
  "detail": "Domain 'example.com' already exists"
}
```

**422 Unprocessable Entity** - Invalid domain format:
```json
{
  "detail": [
    {
      "loc": ["body", "domains", 0],
      "msg": "Invalid domain format",
      "type": "value_error"
    }
  ]
}
```

**401 Unauthorized** - Missing/invalid JWT:
```json
{
  "detail": "Not authenticated"
}
```

### UI Implementation Notes

**Recommended UI Location:** Domain Curation tab (Image 4)

**UI Components Needed:**
1. **"Direct Submit" button** - Opens modal/form
2. **Textarea input** - For pasting domains (one per line or comma-separated)
3. **Checkbox** - "Auto-queue for sitemap analysis" (maps to `auto_queue`)
4. **Submit button** - Triggers API call
5. **Success message** - Shows `submitted_count` and `normalized_domains`
6. **Error handling** - Display 409/422 errors to user

**Example User Flow:**
1. User clicks "Direct Submit Domains"
2. Modal opens with textarea
3. User pastes: `www.example.com, https://test.org, another-domain.net`
4. User checks "Auto-queue" checkbox
5. Frontend splits by comma/newline → `["www.example.com", "https://test.org", "another-domain.net"]`
6. Frontend calls API with `auto_queue: true`
7. Success: "3 domains submitted successfully: example.com, test.org, another-domain.net"
8. Table refreshes to show new domains

---

## 2. Direct Page Submission (WO-009)

### Endpoint
```http
POST /api/v3/pages/direct-submit
```

### Purpose
Bypass WF1-WF4 (search → domain → sitemap → page discovery). Users can directly submit page URLs for contact extraction.

### Request Body
```json
{
  "url": "https://example.com/contact-us",
  "auto_queue": false,
  "priority_level": 5
}
```

**Fields:**
- `url` (string, required): Full page URL to submit
  - Must be valid HTTP/HTTPS URL
  - Domain is extracted and auto-created if doesn't exist (get-or-create pattern)
- `auto_queue` (boolean, optional, default: false):
  - `false`: Page curation status = "New", processing status = NULL
  - `true`: Page curation status = "Selected", processing status = "Queued" (ready for WF7 contact extraction)
- `priority_level` (integer, optional, default: 5): Processing priority (1-10, higher = more urgent)

### Success Response (200)
```json
{
  "page_id": "550e8400-e29b-41d4-a716-446655440001",
  "url": "https://example.com/contact-us",
  "domain_id": "550e8400-e29b-41d4-a716-446655440002",
  "domain": "example.com",
  "auto_queued": false,
  "page_curation_status": "New",
  "page_processing_status": null,
  "priority_level": 5
}
```

**Response Fields:**
- `page_id`: UUID of created page record
- `url`: Submitted URL
- `domain_id`: UUID of domain (created or existing)
- `domain`: Normalized domain name
- `auto_queued`: Whether page was queued for processing
- `page_curation_status`: "New" or "Selected"
- `page_processing_status`: null or "Queued"
- `priority_level`: Processing priority

### Error Responses

**409 Conflict** - Page already exists:
```json
{
  "detail": "Page with URL 'https://example.com/contact-us' already exists"
}
```

**422 Unprocessable Entity** - Invalid URL:
```json
{
  "detail": [
    {
      "loc": ["body", "url"],
      "msg": "Invalid URL format",
      "type": "value_error.url"
    }
  ]
}
```

### UI Implementation Notes

**Recommended UI Location:** Page Curation tab (Image 7)

**UI Components Needed:**
1. **"Direct Submit Page" button** - Opens modal/form
2. **Text input** - For single page URL
3. **Checkbox** - "Queue for contact extraction" (maps to `auto_queue`)
4. **Number input** - "Priority (1-10)" (maps to `priority_level`, default: 5)
5. **Submit button** - Triggers API call
6. **Success message** - Shows page URL and status
7. **Error handling** - Display 409/422 errors

**Example User Flow:**
1. User clicks "Direct Submit Page"
2. Modal opens
3. User enters: `https://example.com/contact-us`
4. User checks "Queue for extraction"
5. User sets priority to 8
6. Frontend calls API with `auto_queue: true, priority_level: 8`
7. Success: "Page submitted successfully and queued for contact extraction"
8. Table refreshes to show new page with status "Queued"

---

## 3. Direct Sitemap Submission (WO-011)

### Endpoint
```http
POST /api/v3/sitemaps/direct-submit
```

### Purpose
Bypass WF1-WF4 (search → domain → sitemap discovery). Users can directly submit sitemap URLs for import.

### Request Body
```json
{
  "url": "https://example.com/sitemap.xml",
  "auto_import": false
}
```

**Fields:**
- `url` (string, required): Full sitemap URL
  - Must be valid HTTP/HTTPS URL ending in `.xml` or containing "sitemap"
  - Domain is extracted and auto-created if doesn't exist
- `auto_import` (boolean, optional, default: false):
  - `false`: Sitemap curation status = "New" (manual review)
  - `true`: Sitemap curation status = "Selected", import status = "Queued" (auto-queued for WF6 import)

### Success Response (200)
```json
{
  "sitemap_file_id": "550e8400-e29b-41d4-a716-446655440001",
  "url": "https://example.com/sitemap.xml",
  "domain_id": "550e8400-e29b-41d4-a716-446655440002",
  "domain": "example.com",
  "auto_imported": false,
  "sitemap_curation_status": "New",
  "sitemap_import_status": null,
  "sitemap_type": "STANDARD"
}
```

**Response Fields:**
- `sitemap_file_id`: UUID of created sitemap record
- `url`: Submitted sitemap URL
- `domain_id`: UUID of domain (created or existing)
- `domain`: Normalized domain name
- `auto_imported`: Whether sitemap was queued for import
- `sitemap_curation_status`: "New" or "Selected"
- `sitemap_import_status`: null or "Queued"
- `sitemap_type`: Always "STANDARD" for direct submissions

### Error Responses

**409 Conflict** - Sitemap already exists:
```json
{
  "detail": "Sitemap with URL 'https://example.com/sitemap.xml' already exists"
}
```

**422 Unprocessable Entity** - Invalid URL:
```json
{
  "detail": [
    {
      "loc": ["body", "url"],
      "msg": "Invalid sitemap URL format",
      "type": "value_error.url"
    }
  ]
}
```

### UI Implementation Notes

**Recommended UI Location:** Sitemap Curation tab (Image 5)

**UI Components Needed:**
1. **"Direct Submit Sitemap" button** - Opens modal/form
2. **Text input** - For sitemap URL
3. **Checkbox** - "Auto-import pages" (maps to `auto_import`)
4. **Submit button** - Triggers API call
5. **Success message** - Shows sitemap URL and status
6. **Error handling** - Display 409/422 errors

**Example User Flow:**
1. User clicks "Direct Submit Sitemap"
2. Modal opens
3. User enters: `https://example.com/sitemap.xml`
4. User checks "Auto-import pages"
5. Frontend calls API with `auto_import: true`
6. Success: "Sitemap submitted successfully and queued for import"
7. Table refreshes to show new sitemap with status "Queued"

---

## Common Patterns Across All Endpoints

### Get-or-Create Domain Pattern
All three endpoints automatically create domains if they don't exist:
- Extract domain from URL
- Check if domain exists in database
- If not, create domain with `sitemap_curation_status: "New"`
- Link submitted resource (page/sitemap) to domain

**Frontend Impact:** Users don't need to create domains first. They can submit pages/sitemaps directly.

### Dual-Status Pattern
Pages and sitemaps use two status fields:
- **Curation Status:** User's decision (New, Selected, Rejected)
- **Processing Status:** System's workflow state (Queued, Processing, Complete, Failed)

**Frontend Impact:** Display both statuses in tables. Auto-queue checkbox affects both.

### Normalization
Domains are normalized to base format:
- `www.example.com` → `example.com`
- `https://example.com` → `example.com`
- `https://www.example.com/path` → `example.com`

**Frontend Impact:** Show normalized domain in success message so users understand what was stored.

---

## Error Handling Best Practices

### 401 Unauthorized
- **Cause:** Missing/invalid JWT token
- **Action:** Redirect to login or refresh token

### 409 Conflict
- **Cause:** Resource already exists
- **Action:** Show friendly message: "This [domain/page/sitemap] already exists. View existing record?"
- **Enhancement:** Provide link to existing record in table

### 422 Unprocessable Entity
- **Cause:** Invalid input format
- **Action:** Show validation error inline on form field
- **Example:** "Invalid URL format. Please enter a valid HTTP/HTTPS URL."

### 500 Internal Server Error
- **Cause:** Backend bug (should not happen after testing)
- **Action:** Show generic error + log to monitoring
- **Message:** "Something went wrong. Please try again or contact support."

---

## Testing Endpoints

### Sample cURL Commands

**Domain Submission:**
```bash
curl -X POST http://localhost:8000/api/v3/domains/direct-submit \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <jwt_token>" \
  -d '{"domains": ["test.com", "example.org"], "auto_queue": false}'
```

**Page Submission:**
```bash
curl -X POST http://localhost:8000/api/v3/pages/direct-submit \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <jwt_token>" \
  -d '{"url": "https://test.com/contact", "auto_queue": true, "priority_level": 8}'
```

**Sitemap Submission:**
```bash
curl -X POST http://localhost:8000/api/v3/sitemaps/direct-submit \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <jwt_token>" \
  -d '{"url": "https://test.com/sitemap.xml", "auto_import": true}'
```

---

## Implementation Checklist

### For Each Tab:

- [ ] Add "Direct Submit" button to UI
- [ ] Create modal/form component
- [ ] Add input validation (URL format, required fields)
- [ ] Implement API call with JWT token
- [ ] Handle success response (show message, refresh table)
- [ ] Handle error responses (401, 409, 422, 500)
- [ ] Add loading state during API call
- [ ] Test with various input formats
- [ ] Test error scenarios
- [ ] Update user documentation

---

## Questions for Backend Team?

Contact: Local Claude (Testing Specialist)  
Documentation: `WO-012.13_TEST_RESULTS.md` (comprehensive test results)  
Code: `src/routers/v3/` (domains, pages, sitemaps direct submission routers)

---

## Appendix: Status Enums

### Domain Statuses
- `sitemap_curation_status`: "New", "Selected", "Rejected"
- `sitemap_analysis_status`: null, "Queued", "Processing", "Complete", "Failed"

### Page Statuses
- `page_curation_status`: "New", "Selected", "Rejected"
- `page_processing_status`: null, "Queued", "Processing", "Complete", "Failed"

### Sitemap Statuses
- `sitemap_curation_status`: "New", "Selected", "Rejected"
- `sitemap_import_status`: null, "Queued", "Processing", "Complete", "Failed"

**Note:** "New" = needs manual review, "Selected" = approved for processing
