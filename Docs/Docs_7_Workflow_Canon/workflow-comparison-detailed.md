> ⚠️ **SOURCE OF TRUTH**
> This document overrides any conflicting information in summaries, dependency trees, or comparison files.
> If code diverges from this document, update THIS document.

# Detailed Workflow Comparison: Complete Data Flow Map

_Note: Path prefixes (e.g., \`src/\`, \`static/js/\`) are sometimes omitted in table cells for brevity – see linked code or canonical YAMLs for exact, fully-qualified project paths._

This expanded table maps the complete data flow across all six interrelated workflows, including source tables and destination services.

## Comprehensive Workflow Comparison

| Functional Step                  | WF1: Single Search → Place Create              | WF2: Staging → Deep Scan                    | WF3: Local Biz → Domain Extract                     | WF4: Domain → Sitemap Analysis                       | WF5: Sitemap File → Import Queue               | WF6: Sitemap Import → Page Create        | WF7: Page Curation → Processing     | **Key Principles / Requirements**                                                                                                                                                                                                                                                                                      | **Guiding Documentation**                                                                                                                                                                                                                                                                                                |
| -------------------------------- | ---------------------------------------------- | ------------------------------------------- | --------------------------------------------------- | ---------------------------------------------------- | ---------------------------------------------- | ---------------------------------------- | ----------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **0. Primary Source Table Read** | `place_searches` (Job Tracking) / _(Ext. API)_ | `places`                                    | `local_businesses`                                  | `domains`                                            | `sitemap_files`                                | `sitemap_files`                          | `pages`                             | **ORM Required, Connection Management**<br>**WHY:** Database operations must be standardized, secure, and maintain connection pooling<br>**HOW:** Use SQLAlchemy ORM exclusively with proper session handling and Supavisor connection parameters                                                                      | [01-ABSOLUTE_ORM_REQUIREMENT.md](../Docs_1_AI_GUIDES/01-ABSOLUTE_ORM_REQUIREMENT.md)<br>[07-DATABASE_CONNECTION_STANDARDS.md](../Docs_1_AI_GUIDES/07-DATABASE_CONNECTION_STANDARDS.md)                                                                                                                                   |
| **1. UI Interaction (JS)**       | `static/js/single-search-tab.js`               | `static/js/staging-editor-tab.js`           | `static/js/local-business-curation-tab.js`          | `static/js/domain-curation-tab.js`                   | `static/js/sitemap-curation-tab.js`            | _(N/A - Background Process)_             | `static/js/page-curation-tab.js`    | **API Standardization, Clear User Feedback**<br>**WHY:** UI must provide consistent experience and communicate clearly with backend API<br>**HOW:** Follow standard API naming conventions (/api/v3/), provide loading indicators and error handling                                                                   | [15-API_STANDARDIZATION_GUIDE.md](../Docs_1_AI_GUIDES/15-API_STANDARDIZATION_GUIDE.md)                                                                                                                                                                                                                                   |
| **1.1 HTML Tab Identifier**      | `singleSearch`                                 | `stagingEditor`                             | `localBusinessCuration`                             | `domainCurationPanel`                                | `sitemapCurationPanel`                         | _(N/A - Background Process)_             | `pageCurationPanel`                 | **Code Organization, UI Consistency**<br>**WHY:** Frontend components must follow consistent patterns for maintainability<br>**HOW:** Use standardized tab identifiers, consistent naming conventions, and structured HTML layout                                                                                      | [17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization](../Docs_1_AI_GUIDES/17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization)                                                                                                                                                                                   |
| **1.2 Tab JavaScript File**      | `static/js/single-search-tab.js`               | `static/js/staging-editor-tab.js`           | `static/js/local-business-curation-tab.js`          | `static/js/domain-curation-tab.js`                   | `static/js/sitemap-curation-tab.js`            | _(N/A - Background Process)_             | `static/js/page-curation-tab.js`    | **API Standardization, Code Organization**<br>**WHY:** JavaScript components must interact consistently with backend<br>**HOW:** Implement standardized API calls, consistent error handling, and follow the same AJAX patterns across tabs                                                                            | [15-API_STANDARDIZATION_GUIDE.md](../Docs_1_AI_GUIDES/15-API_STANDARDIZATION_GUIDE.md)<br>[17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization](../Docs_1_AI_GUIDES/17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization)                                                                                         |
| **2. API Request Schema**        | `api_models::PlacesSearchRequest`              | `api_models::PlaceBatchStatusUpdateRequest` | `api_models::LocalBusinessBatchStatusUpdateRequest` | `api_models::DomainBatchCurationStatusUpdateRequest` | `schemas/sitemap_file::SitemapFileBatchUpdate` | _(N/A - Triggered by WF5 DB state)_      | `PageBatchStatusUpdateRequest`      | **API Standardization, Enum Handling, Validation**<br>**WHY:** Input validation must be consistent and type-safe across all endpoints<br>**HOW:** Use Pydantic models for validation, explicit Enum types for status values, and consistent naming conventions                                                         | [15-API_STANDARDIZATION_GUIDE.md](../Docs_1_AI_GUIDES/15-API_STANDARDIZATION_GUIDE.md)<br>[27-ENUM_HANDLING_STANDARDS.md](../Docs_1_AI_GUIDES/27-ENUM_HANDLING_STANDARDS.md)                                                                                                                                             |
| **3. API Router**                | `routers/google_maps_api.py`                   | `routers/places_staging.py`                 | `routers/local_businesses.py`                       | `routers/domains.py`                                 | `routers/sitemap_files.py`                     | _(N/A - Background process)_             | `routers/pages.py`                  | **Authentication Boundary, Transaction Boundaries, API Standardization**<br>**WHY:** Routers must enforce authentication, define clear API contracts, and manage transactions<br>**HOW:** Use FastAPI dependency injection for auth, begin/commit transactions, maintain consistent API structure with /api/v3/ prefix | [11-AUTHENTICATION_BOUNDARY.md](../Docs_1_AI_GUIDES/11-AUTHENTICATION_BOUNDARY.md)<br>[13-TRANSACTION_MANAGEMENT_GUIDE.md](../Docs_1_AI_GUIDES/13-TRANSACTION_MANAGEMENT_GUIDE.md)<br>[15-API_STANDARDIZATION_GUIDE.md](../Docs_1_AI_GUIDES/15-API_STANDARDIZATION_GUIDE.md)                                             |
| **4. Core Logic Location**       | Service (via background task)                  | Router directly                             | Router directly                                     | Router directly                                      | Delegated to service                           | Background service                       | (To Be Decided: Router/Service)     | **Code Organization, Transaction Boundaries**<br>**WHY:** Clear separation of concerns between routing and business logic maintains clean architecture<br>**HOW:** Simple updates handled in router, complex processing delegated to services; background tasks for long-running operations                            | [17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization](../Docs_1_AI_GUIDES/17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization)<br>[13-TRANSACTION_MANAGEMENT_GUIDE.md](../Docs_1_AI_GUIDES/13-TRANSACTION_MANAGEMENT_GUIDE.md)                                                                                   |
| **5. Core Logic Service**        | `services/places/places_search_service.py`     | N/A (in Router)                             | N/A (in Router)                                     | N/A (in Router)                                      | `services/sitemap_files_service.py`            | `services/sitemap_import_service.py`     | `services/page_curation_service.py` | **ORM Required, Transaction Awareness, Error Handling**<br>**WHY:** Business logic must be maintainable, handle errors gracefully, and respect transaction boundaries<br>**HOW:** Services accept session parameters but don't manage transactions, use ORM exclusively, implement comprehensive error handling        | [01-ABSOLUTE_ORM_REQUIREMENT.md](../Docs_1_AI_GUIDES/01-ABSOLUTE_ORM_REQUIREMENT.md)<br>[13-TRANSACTION_MANAGEMENT_GUIDE.md](../Docs_1_AI_GUIDES/13-TRANSACTION_MANAGEMENT_GUIDE.md)<br>[17-CORE_ARCHITECTURAL_PRINCIPLES.md#6-error-handling](../Docs_1_AI_GUIDES/17-CORE_ARCHITECTURAL_PRINCIPLES.md#6-error-handling) |
| **6. Primary DB Model**          | `models/place_search.py::PlaceSearch`          | `models/place.py::Place`                    | `models/local_business.py::LocalBusiness`           | `models/domain.py::Domain`                           | `models/sitemap.py::SitemapFile`               | `models/sitemap.py::SitemapFile` (Input) | `models/page.py::Page`              | **ORM Required, UUID Standardization**<br>**WHY:** Database models must match schema exactly and follow consistent patterns<br>**HOW:** Implement SQLAlchemy models that mirror database tables, use UUID fields for IDs, implement proper relationships                                                               | [01-ABSOLUTE_ORM_REQUIREMENT.md](../Docs_1_AI_GUIDES/01-ABSOLUTE_ORM_REQUIREMENT.md)<br>[16-UUID_STANDARDIZATION_GUIDE.md](../Docs_1_AI_GUIDES/16-UUID_STANDARDIZATION_GUIDE.md)<br>[25-SQLALCHEMY_MODEL_INTEGRITY_GUIDE.md](../Docs_1_AI_GUIDES/25-SQLALCHEMY_MODEL_INTEGRITY_GUIDE.md)                                 |
| **7. Primary Status Field**      | `status` (on `PlaceSearch`)                    | `status`                                    | `status`                                            | `sitemap_curation_status`                            | `deep_scrape_curation_status`                  | `sitemap_import_status` (Input)          | `page_curation_status`              | **Enum Handling, ORM Required**<br>**WHY:** Status fields drive workflow transitions and must be consistently managed<br>**HOW:** Define status fields with explicit enum types, validate all status values, ensure consistent naming (snake_case)                                                                     | [27-ENUM_HANDLING_STANDARDS.md](../Docs_1_AI_GUIDES/27-ENUM_HANDLING_STANDARDS.md)<br>[01-ABSOLUTE_ORM_REQUIREMENT.md](../Docs_1_AI_GUIDES/01-ABSOLUTE_ORM_REQUIREMENT.md)                                                                                                                                               |
| **8. Primary Status Enum**       | `PlaceSearchStatusEnum`                        | `PlaceStatusEnum`                           | `PlaceStatusEnum` (reused)                          | `SitemapCurationStatusEnum`                          | `SitemapDeepCurationStatusEnum`                | `SitemapImportStatusEnum`                | `PageCurationStatus`                | **Enum Handling, Code Organization**<br>**WHY:** Status enums define the workflow state machine and must be consistently implemented<br>**HOW:** Define Python enums that map directly to database types, use consistent naming, include all required status values                                                    | [27-ENUM_HANDLING_STANDARDS.md](../Docs_1_AI_GUIDES/27-ENUM_HANDLING_STANDARDS.md)<br>[17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization](../Docs_1_AI_GUIDES/17-CORE_ARCHITECTURAL_PRINCIPLES.md#8-code-organization)                                                                                             |
| **9. Queue Status Field**        | `status` (on `Place` model, Output)            | `deep_scan_status`                          | `domain_extraction_status`                          | `sitemap_analysis_status`                            | `deep_scrape_process_status`                   | `status` (on `Page` model, Output)       | `page_processing_status`            | **Background Task Pattern, Enum Handling**<br>**WHY:** Queue status fields enable decoupled background processing through status-based triggers<br>**HOW:** Implement a separate status field for background processing that schedulers monitor, set to 'Queued' to trigger processing                                 | [21-SCHEDULED_TASKS_APSCHEDULER_PATTERN.md](../Docs_1_AI_GUIDES/21-SCHEDULED_TASKS_APSCHEDULER_PATTERN.md)<br>[27-ENUM_HANDLING_STANDARDS.md](../Docs_1_AI_GUIDES/27-ENUM_HANDLING_STANDARDS.md)                                                                                                                         |
| **10. Queue Status Enum**        | `PlaceStatusEnum` (Output)                     | `DeepScanStatusEnum`                        | `DomainExtractionStatusEnum`                        |
