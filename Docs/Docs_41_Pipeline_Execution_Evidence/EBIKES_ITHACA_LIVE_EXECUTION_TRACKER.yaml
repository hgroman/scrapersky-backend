---
pipeline_execution_tracker: "WF1-WF7 Live Pipeline Test - Ebikes Ithaca NY"
execution_date: "2025-08-24"
execution_start_time: "2025-08-24 13:40:58 EDT"
execution_end_time: ""
total_execution_time_seconds: 0
status: "executing_wf1"

authentication:
  jwt_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5NTAwMTYxNy0xMjk5LTQwMDYtODBhMC1kYTdkNjM4ZjgyYWIiLCJleHAiOjE3NTYwNjQ0MjB9.4i1_YHtvx_SOsr6JZtx252jCAfCFCPs4lEy8PniRvw0"
  token_expires: "2025-08-25"
  base_url: "http://localhost:8000"
  user_uuid: "95001617-1299-4006-80a0-da7d638f82ab"

database_baseline:
  pre_execution_counts:
    jobs: 1573
    places_staging: 1314  
    local_businesses: 230
    domains: null
    sitemap_files: null
    sitemap_urls: null
    pages: null
  post_wf1_counts:
    jobs: 1573  # No change - existing job record reused
    places_staging: 1324  # +10 new places discovered
    local_businesses: 230
    domains: null
    sitemap_files: null
    sitemap_urls: null
    pages: null

workflows:
  WF1_Scout:
    name: "Business Discovery via Google Maps API"
    status: "completed"
    start_time: "2025-08-24 13:40:58 EDT"
    end_time: "2025-08-24 13:41:01 EDT"
    duration_seconds: 3
    
    api_call:
      endpoint: "POST /api/v3/localminer-discoveryscan/search/places"
      method: "POST"
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5NTAwMTYxNy0xMjk5LTQwMDYtODBhMC1kYTdkNjM4ZjgyYWIiLCJleHAiOjE3NTYwNjQ0MjB9.4i1_YHtvx_SOsr6JZtx252jCAfCFCPs4lEy8PniRvw0"
    
    request_payload:
      business_type: "ebike bicycle electric bike shop"
      location: "Ithaca, NY"
      radius_km: 10
      tenant_id: null
    
    response:
      status_code: 200
      response_body: 
        job_id: "8bc2c574-f4bf-476d-b75a-624285f58863"
        status_url: "/api/v3/localminer-discoveryscan/search/status/8bc2c574-f4bf-476d-b75a-624285f58863"
        status: "processing"
      job_id: "8bc2c574-f4bf-476d-b75a-624285f58863"
      status_url: "/api/v3/localminer-discoveryscan/search/status/8bc2c574-f4bf-476d-b75a-624285f58863"
      
    final_status:
      job_status: "complete"
      progress: 1.0
      created_at: "2025-08-24T17:40:58.916501Z"
      updated_at: "2025-08-24T17:41:01.170421Z"
      completed_at: "2025-08-24T17:41:01.170421Z"
      
    database_impact:
      target_tables: ["jobs", "places_staging"]
      jobs_records_created: 0  # Job record reused
      places_staging_records_created: 10
      search_job_id_linkage_verified: true
      discovered_places:
        - name: "REI"
          place_id: "ChIJPxFTsPGB0IkR3PUTiGKOcRg"
          id: "1411"
          rating: 4.6
          address: "742 S Meadow St Suite 200, Ithaca, NY 14850"
        - name: "Ithaca Bikeshare"
          place_id: "ChIJv353-yOB0IkRLq1OOEjlWp4"
          id: "1412"
          rating: 3.0
          address: "Cascadilla St, Ithaca, NY 14850"
        - name: "Ithaca Bike Rental"
          place_id: "ChIJm6S1-zKC0IkR5CjsPwPS1Tk"
          id: "1413"
          rating: 4.9
          address: "1 James L Gibbs Dr, Ithaca, NY 14850"
        - name: "Ithaca Scooter & Cycle"
          place_id: "ChIJ2Ve7ANSF0IkRYhbtJ2cRP7A"
          id: "1410"
          rating: 5.0
          address: "47 Sage Rd, Ithaca, NY 14850"
        - name: "Gorges Cycles"
          place_id: "ChIJ-bSvRnSD0IkRGft83PWOQkA"
          id: "1407"
          rating: 4.9
          address: "2255 N Triphammer Rd, Ithaca, NY 14850"
        - name: "Cayuga Ski & Cyclery"
          place_id: "ChIJnZS1QXGB0IkR_dCFXVeXzXg"
          id: "1408"
          rating: 4.4
          address: "624 W State St, Ithaca, NY 14850"
        - name: "Bike Walk Tompkins"
          place_id: "ChIJPZciwp2B0IkR7OKTB8cgBmE"
          id: "1409"
          rating: 4.5
          address: "Behind Enterprise, 803 Cascadilla St, Ithaca, NY 14850"
        - name: "Finger Lakes Electric Bikes"
          place_id: "ChIJTbS2nsPb0IkRvhjUfwQ9iZM"
          id: "1414"
          rating: 4.9
          address: "783 Canandaigua Rd, Geneva, NY 14456"
        - name: "Swan Cycles Inc"
          place_id: "ChIJOef9e9l42okRssjv9eGLWYs"
          id: "1415"
          rating: 5.0
          address: "226 Mt Pleasant Rd, Freeville, NY 13068"
        - name: "The Bike Rack"
          place_id: "ChIJnU1g142B0IkRlVexMR238G4"
          id: "1416"
          rating: 4.4
          address: "409 College Ave, Ithaca, NY 14850"
      
    verification:
      job_status_check: 
        status: "complete"
        progress: 1.0
        execution_time: 3_seconds
      places_count_verification:
        pre_count: 1314
        post_count: 1324
        new_places: 10
        verification_passed: true
      error_log: []
      success: true

  WF2_Analyst:
    name: "Places Staging to Selection"
    status: "completed"
    start_time: "2025-08-24 13:49:18 EDT"
    end_time: "2025-08-24 13:49:18 EDT"
    duration_seconds: 1
    depends_on: "WF1_Scout"
    
    api_call:
      endpoint: "PUT /api/v3/places/staging/status"
      method: "PUT"
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    
    request_payload:
      place_ids: ["ChIJnU1g142B0IkRlVexMR238G4","ChIJv353-yOB0IkRLq1OOEjlWp4"]
      status: "Selected"
    
    response:
      status_code: 200
      response_body:
        message: "Status update request processed. Matched and updated: 2 places. Queued for deep scan: 2."
        updated_count: 2
        queued_count: 2
      
    database_impact:
      target_tables: ["places_staging"]
      status_changes: 2
      updated_place_ids: ["ChIJnU1g142B0IkRlVexMR238G4","ChIJv353-yOB0IkRLq1OOEjlWp4"]
      pre_existing_selected: 5
      total_selected: 7
      total_places_from_search: 10
      deep_scan_queued: 2
      
    verification:
      status_change_verification:
        places_updated: 2
        total_selected_after: 7
        verification_passed: true
      updated_at_verification:
        timestamps_updated: true
      discovery:
        some_places_already_selected: true
        explanation: "5 places were already 'Selected' from previous operations"
      error_log: []
      success: true

  WF3_Navigator:
    name: "Business Curation & Domain Extraction Queueing"
    status: "completed" 
    start_time: "2025-08-24 13:56:00 EDT"
    end_time: "2025-08-24 13:56:00 EDT"
    duration_seconds: 1
    depends_on: "WF2_Analyst"
    
    api_call:
      endpoint: "PUT /api/v3/local-businesses/status"
      method: "PUT"
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    
    request_payload:
      local_business_ids: ["02a149f9-ee77-4b33-a227-7a536b784df8","013d7ea2-79b9-4943-8a43-4f6340327f16","c256e137-cd5a-4554-9fe2-37450456ff15"]
      status: "Selected"
    
    response:
      status_code: 200
      response_body:
        message: "Successfully updated status for 3 local businesses."
        updated_count: 3
        queued_count: 3
      
    database_impact:
      target_tables: ["local_businesses"]
      status_updates: 3
      domain_extraction_queued: 3
      selected_businesses:
        - id: "02a149f9-ee77-4b33-a227-7a536b784df8"
          name: "Ithaca Bikeshare"
          domain_extraction_status: "Completed"
        - id: "013d7ea2-79b9-4943-8a43-4f6340327f16"
          name: "The Bike Rack"
          domain_extraction_status: "Completed"
        - id: "c256e137-cd5a-4554-9fe2-37450456ff15"
          name: "Ithaca Scooter & Cycle"
          domain_extraction_status: "Completed"
      
    verification:
      dual_status_verification:
        status_updated_to_selected: 3
        domain_extraction_status_updated: 3
        verification_passed: true
      queueing_verification:
        domain_extraction_already_completed: true
        explanation: "Background processing had already completed domain extraction"
      error_log: []
      success: true

  WF4_Surveyor:
    name: "Domain Curation & Sitemap Analysis Trigger"
    status: "completed"
    start_time: "2025-08-24 13:59:10 EDT"
    end_time: "2025-08-24 13:59:10 EDT"  
    duration_seconds: 1
    depends_on: "WF3_Navigator"
    
    api_call:
      endpoint: "PUT /api/v3/domains/sitemap-curation/status"
      method: "PUT"
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    
    request_payload:
      domain_ids: ["12332a57-0c58-4c06-826f-e358636f5803","cfe54fc0-54f2-4510-8f8b-52dd94cf7e55","8d40b159-ce28-4cbd-81be-1e1f7f4254a8"]
      sitemap_curation_status: "Selected"
    
    response:
      status_code: 200
      response_body:
        updated_count: 3
        queued_count: 3
      
    database_impact:
      target_tables: ["domains"]
      curation_status_changes: 3
      analysis_triggers: 3
      selected_domains:
        - id: "12332a57-0c58-4c06-826f-e358636f5803"
          domain: "gorgescycles.com"
          sitemap_curation_status: "Selected"
          sitemap_analysis_status: "submitted"
        - id: "cfe54fc0-54f2-4510-8f8b-52dd94cf7e55"
          domain: "fingerlakeselectricbikes.com"
          sitemap_curation_status: "Selected"
          sitemap_analysis_status: "submitted"
        - id: "8d40b159-ce28-4cbd-81be-1e1f7f4254a8"
          domain: "ithacabikerental.com"
          sitemap_curation_status: "Selected"
          sitemap_analysis_status: "submitted"
      
    verification:
      curation_status_verification:
        domains_updated_to_selected: 3
        verification_passed: true
      analysis_trigger_verification:
        analysis_status_submitted: 3
        background_processing_triggered: true
      error_log: []
      success: true

  WF5_Flight_Planner:
    name: "Sitemap Discovery & Analysis"
    status: "completed"
    start_time: "2025-08-24 14:22:23 EDT"
    end_time: "2025-08-24 14:30:00 EDT"
    duration_seconds: 458
    depends_on: "WF4_Surveyor"
    
    api_call:
      endpoint: "POST /api/v3/sitemap/scan"
      method: "POST"
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    
    request_payload:
      base_url: "https://gorgescycles.com"
      max_pages: 1000
      tenant_id: null
    
    response:
      status_code: 200
      response_body:
        job_id: "57d7c194-200a-4b61-8637-c1bfd832c46c"
        status_url: "/api/v3/sitemap/status/57d7c194-200a-4b61-8637-c1bfd832c46c"
        created_at: "2025-08-24T18:22:26.918502"
      job_id: "57d7c194-200a-4b61-8637-c1bfd832c46c"
      status: "running"
      status_url: "/api/v3/sitemap/status/57d7c194-200a-4b61-8637-c1bfd832c46c"
      
    job_monitoring:
      status: "complete"
      progress: 1.0
      domain_scanned: "gorgescycles.com"
      
    database_impact:
      target_tables: ["sitemap_files", "sitemap_urls"]
      sitemap_files_discovered: 2  # Found 2 sitemap files from fingerlakeselectricbikes.com
      urls_extracted: 6  # Total URLs (5 + 1)
      sitemap_types_found: ["category-sitemap", "post-sitemap"]
      discovery_result: "Successfully found sitemaps for fingerlakeselectricbikes.com"
      discovered_sitemap_files:
        - id: "c63ed0f7-e259-46bf-953e-0909d0b54dc3"
          domain: "fingerlakeselectricbikes.com"
          url: "https://fingerlakeselectricbikes.com/category-sitemap.xml"
          url_count: 5
          status: "New"
        - id: "b665c6c6-9acd-4b6b-91e6-22f3ce4ad3b2"
          domain: "fingerlakeselectricbikes.com"
          url: "https://fingerlakeselectricbikes.com/post-sitemap.xml"
          url_count: 1
          status: "New"
      
    verification:
      sitemap_discovery_verification:
        retry_successful: true
        domains_processed: ["gorgescycles.com", "fingerlakeselectricbikes.com"]
        sitemaps_found: true
        successful_domain: "fingerlakeselectricbikes.com"
        explanation: "gorgescycles.com had no sitemaps, fingerlakeselectricbikes.com successful"
      url_extraction_verification:
        urls_extracted: 6
        verification_passed: true
      error_log: []
      success: true

  WF6_Recorder:
    name: "Sitemap Import & Page Creation"
    status: "pending"
    start_time: ""
    end_time: ""
    duration_seconds: 0
    depends_on: "WF5_Flight_Planner"
    
    api_call:
      endpoint: "PUT /api/v3/sitemap-files/sitemap_import_curation/status"
      method: "PUT"
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer {jwt_token}"
    
    request_payload:
      sitemap_file_ids: []  # Will be populated from discovered sitemaps
      sitemap_import_curation_status: "Selected"
    
    response:
      status_code: null
      response_body: {}
      updated_count: 0
      queued_count: 0
      
    database_impact:
      target_tables: ["sitemap_files", "pages"]
      import_status_updates: 0
      pages_created: 0
      
    verification:
      import_status_verification: {}
      page_creation_verification: {}
      error_log: []
      success: false

  WF7_Extractor:
    name: "Page Content Extraction"
    status: "pending"
    start_time: ""
    end_time: ""
    duration_seconds: 0
    depends_on: "WF6_Recorder"
    
    api_call:
      endpoint: "PUT /api/v3/pages/status"
      method: "PUT"
      headers:
        Content-Type: "application/json"
        Authorization: "Bearer {jwt_token}"
    
    request_payload:
      page_ids: []  # Will be populated from created pages
      status: "Queued"
    
    response:
      status_code: null
      response_body: {}
      updated_count: 0
      queued_count: 0
      
    database_impact:
      target_tables: ["pages"]
      curation_status_updates: 0
      processing_status_updates: 0
      content_extraction_queued: 0
      
    verification:
      dual_status_pattern_verification: {}
      processing_queue_verification: {}
      content_extraction_verification: {}
      error_log: []
      success: false

pipeline_results:
  summary:
    total_businesses_discovered: 0
    businesses_selected_for_processing: 0
    domains_extracted: 0
    domains_curated: 0
    sitemaps_analyzed: 0
    sitemap_files_imported: 0
    pages_created: 0
    pages_queued_for_processing: 0
    final_content_extracted: 0
    
  performance_metrics:
    total_pipeline_time_seconds: 0
    average_api_response_time_ms: 0
    database_operations_count: 0
    background_job_completion_rate: 0
    
  error_summary:
    total_errors: 0
    api_errors: 0
    database_errors: 0 
    background_job_errors: 0
    
  final_verification:
    pipeline_integrity_verified: false
    data_consistency_verified: false
    all_workflows_successful: false
    end_to_end_proof_generated: false

execution_log:
  - timestamp: "2025-08-24 13:40:12 EDT"
    event: "WF1_INITIAL_ATTEMPT_FAILED"
    details: "First attempt failed due to invalid UUID 'pipeline_test_user' in JWT token"
    error: "sqlalchemy.dialects.postgresql.asyncpg.Error: invalid input for query argument $3"
  - timestamp: "2025-08-24 13:40:58 EDT" 
    event: "WF1_RETRY_SUCCESS"
    details: "Generated new JWT with proper UUID (95001617-1299-4006-80a0-da7d638f82ab)"
    job_id: "8bc2c574-f4bf-476d-b75a-624285f58863"
    status: "processing"
  - timestamp: "2025-08-24 13:41:01 EDT"
    event: "WF1_COMPLETED"
    details: "Successfully discovered 10 ebike businesses in Ithaca, NY"
    job_id: "8bc2c574-f4bf-476d-b75a-624285f58863"
    places_discovered: 10
    execution_time: 3_seconds
    yaml_updated: true
  - timestamp: "2025-08-24 13:49:18 EDT"
    event: "WF2_COMPLETED"
    details: "Selected 2 additional places for processing (7 total selected)"
    places_updated: 2
    places_queued_for_deep_scan: 2
    total_selected_places: 7
    yaml_updated: true
  - timestamp: "2025-08-24 13:56:00 EDT"
    event: "WF3_COMPLETED"
    details: "Selected 3 local businesses for domain processing"
    businesses_updated: 3
    domain_extraction_queued: 3
    businesses_already_processed: true
    note: "Domain extraction was already completed by background processing"
    yaml_updated: true
  - timestamp: "2025-08-24 13:59:10 EDT"
    event: "WF4_COMPLETED"
    details: "Selected 3 ebike domains for sitemap analysis"
    domains_updated: 3
    domains_queued: 3
    selected_domains: ["gorgescycles.com", "fingerlakeselectricbikes.com", "ithacabikerental.com"]
    sitemap_analysis_triggered: true
    yaml_updated: true
  - timestamp: "2025-08-24 14:22:23 EDT"
    event: "WF5_INITIATED"
    details: "Started sitemap scan for gorgescycles.com"
    job_id: "57d7c194-200a-4b61-8637-c1bfd832c46c"
    domain: "gorgescycles.com"
    status: "running"
    progress: 0.1
    yaml_updated: true
  - timestamp: "2025-08-24 14:30:00 EDT"
    event: "WF5_INITIAL_COMPLETED"
    details: "Sitemap scan completed for gorgescycles.com - no sitemaps found"
    job_id: "57d7c194-200a-4b61-8637-c1bfd832c46c"
    domain: "gorgescycles.com"
    status: "complete"
    progress: 1.0
    sitemap_files_discovered: 0
    explanation: "Domain has no accessible sitemap.xml or robots.txt sitemaps"
    yaml_updated: true
  - timestamp: "2025-08-24 14:37:31 EDT"
    event: "WF5_RETRY_INITIATED"
    details: "Started retry sitemap scan for fingerlakeselectricbikes.com"
    job_id: "74990034-58a6-4513-9576-336fe7910447"
    domain: "fingerlakeselectricbikes.com"
    yaml_updated: true
  - timestamp: "2025-08-24 14:38:00 EDT"
    event: "WF5_RETRY_SUCCESS"
    details: "Successfully discovered 2 sitemap files from fingerlakeselectricbikes.com"
    job_id: "74990034-58a6-4513-9576-336fe7910447"
    domain: "fingerlakeselectricbikes.com"
    sitemap_files_discovered: 2
    urls_extracted: 6
    sitemap_file_ids: ["c63ed0f7-e259-46bf-953e-0909d0b54dc3", "b665c6c6-9acd-4b6b-91e6-22f3ce4ad3b2"]
    wf5_complete_with_fruit: true
    yaml_updated: true