# **RBAC Sidebar Features - State of the Nation**

## **ğŸ” Overview**

This document provides a comprehensive overview of the **Role-Based Access Control (RBAC) sidebar feature architecture**, its **design, implementation, and next steps**. It serves as a living reference for the **current state of development**, ensuring clarity between **backend (FastAPI, Cursor), frontend (lovable.DEV, React), and deployment (Render, GitHub).**

---

## **ğŸ¯ Objectives**

### **1. High-Level Goals**

- Implement **RBAC-driven sidebar navigation** that dynamically shows/hides items based on the userâ€™s role and permissions.
- Separate **sidebar links for services vs. configuration** (e.g., admin-only vs. tenant-user accessible features).
- Ensure **API endpoints return the correct sidebar structure** dynamically per **tenant, role, and permissions**.
- Provide a **clear architecture** that **frontend (React) and backend (FastAPI)** can seamlessly integrate.

### **2. Deployment & DevOps**

- **Backend** is managed via **FastAPI** (Cursor-assisted development).
- **API is deployed via Render** (GitHub â†’ Docker build â†’ FastAPI endpoints live).
- **Frontend (React) built via lovable.DEV** to consume API and render sidebar dynamically.

---

## **ğŸ› ï¸ System Architecture & Moving Parts**

### **1. Database Schema**

RBAC is managed across **three key tables**:

#### **ğŸ“Œ Feature Flags (`feature_flags`)**

Defines all available features in the system.

```sql
CREATE TABLE feature_flags (
    id UUID PRIMARY KEY,
    name VARCHAR NOT NULL UNIQUE,
    description VARCHAR,
    default_enabled BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### **ğŸ“Œ Tenant Features (`tenant_features`)**

Tracks which features are enabled per **tenant**.

```sql
CREATE TABLE tenant_features (
    id UUID PRIMARY KEY,
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    feature_id UUID NOT NULL REFERENCES feature_flags(id),
    is_enabled BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(tenant_id, feature_id)
);
```

#### **ğŸ“Œ Sidebar Features (`sidebar_features`)**

Defines **UI elements for enabled features**, including **display order and permission requirements**.

```sql
CREATE TABLE sidebar_features (
    id UUID PRIMARY KEY,
    feature_id UUID NOT NULL REFERENCES feature_flags(id),
    sidebar_name VARCHAR NOT NULL,
    url_path VARCHAR NOT NULL,
    icon VARCHAR,
    display_order INTEGER,
    requires_permission VARCHAR,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

### **2. API Endpoints (FastAPI)**

| Endpoint                                                          | Functionality                        |
| ----------------------------------------------------------------- | ------------------------------------ |
| `/api/v2/role_based_access_control/sidebar-features`              | Fetch sidebar based on tenant & role |
| `/api/v2/role_based_access_control/feature-flags`                 | Fetch all feature flags              |
| `/api/v2/role_based_access_control/tenant-features`               | Fetch enabled features per tenant    |
| `/api/v2/role_based_access_control/sidebar-features/{feature_id}` | Fetch a single sidebar feature       |

### **3. Data Flow: How Sidebar Loads**

1. **User Logs In â†’ API fetches userâ€™s role & permissions**
2. **Frontend requests sidebar from `/sidebar-features` endpoint**
3. **Backend retrieves enabled features for the tenant** â†’ (`tenant_features` âœ… check)
4. **Filters sidebar items based on user role & permission**
5. **Frontend renders allowed sidebar items** dynamically

---

## **âœ… Current Status**

### **1. Backend Status (FastAPI) ğŸ¯**

âœ” API endpoints are defined & functioning.
âœ” Feature flagging & tenant enablement **working as expected**.
âœ” Role-based filtering **correctly determines sidebar visibility**.
âœ” **Data pipeline is verified** (correct tenant-feature-sidebar mapping).

### **2. Frontend Status (lovable.DEV, React) ğŸš§**

âœ” API Integration planned, but not yet complete.
âœ” Sidebar rendering logic needs to dynamically respect **role-based filtering**.
âœ” Awaiting final backend deployment **before full integration**.

### **3. Deployment Status (Render) ğŸš€**

âœ” Backend will deploy via **GitHub â†’ Dockerfile â†’ Render**.
âœ” Production API will be available for **lovable.DEV to integrate**.

---

## **ğŸ“Œ Next Steps**

### **Phase 1: Final Backend Validation**

- **Confirm API responses** with different roles.
- Ensure **RBAC correctly hides unauthorized sidebar items**.
- Push final changes to **GitHub for deployment**.

### **Phase 2: Deploy & Frontend Integration**

- Deploy **FastAPI to Render (Production API live)**.
- lovable.DEV begins **React development**.
- **Sidebar renders dynamically based on RBAC logic.**

### **Phase 3: Granular Page-Level Access Control**

- Once sidebar RBAC is **working**, add **fine-grained** feature access **within pages**.
- Ensure API enforces **role-based restrictions at endpoint level**.

---

## **ğŸ“Š Diagrams**

### **Sidebar API Flow**

```
User â†’ Logs In â†’ API Fetches Role
          â†“
Frontend â†’ Requests Sidebar API (/sidebar-features)
          â†“
Backend â†’ Queries Tenant Features â†’ Filters Sidebar Features â†’ Returns Sidebar
          â†“
Frontend â†’ Renders Allowed Sidebar Items
```

### **RBAC Data Flow**

```
feature_flags  â”€â”€â”€â–¶ tenant_features (Is feature enabled?)  â”€â”€â”€â–¶ sidebar_features (UI element?)  â”€â”€â”€â–¶ Frontend
```

---

## **Final Thoughts**

This document serves as the **RBAC Sidebar State of the Nation**, capturing our **design, implementation, and next steps**. As we move forward:

- **Backend is stable** and ready for deployment.
- **Frontend integration begins soon** (after Render deploys API).
- **Final testing & refinements** will follow once React UI is connected.

ğŸ¯ **The immediate priority:** Get **FastAPI deployed**, so lovable.DEV can build against it.

ğŸš€ Ready to execute? Letâ€™s move to **Phase 1: Final Backend Validation.**
