# The V2 Development Compass: A Case Study of the WF7 Implementation

**Version:** 1.0
**Date:** 2025-08-02
**Purpose:** To serve as the authoritative guide and case study for all ScraperSky V2 development, ensuring architectural consistency, quality, and adherence to the established agent-based protocol.

---

## 1. Mission: The V2 Protocol

This document codifies the successful methodology used to implement the V2 WF7 "Extractor" workflow. This is not merely a technical summary; it is the **operational playbook** for all future development. The core principle is this: **The process is the innovation.**

Our architecture is defined by a strict separation of powers:
- **Workflow Agents (e.g., WF7 Agent):** The **Deciders**. They own the end-to-end implementation of a business workflow. They manage the project, but they do not assume expertise in every domain.
- **Layer Guardians (e.g., L1 Data Sentinel):** The **Specialists**. They are advisory-only experts for a single architectural layer. They hold the "truth" for their domain's patterns and blueprints.

**The Golden Rule of V2 Development:** A Workflow Agent **must not** implement a component without first seeking a formal, compliant design advisory from the appropriate Layer Guardian.

## 2. The WF7 Case Study: A Step-by-Step Execution of the Protocol

What follows is the exact, successful path taken to build the V2 WF7 workflow. This is the compass. Follow it.

### Step 1: Assume the Role & Define the Goal
- **Action:** The lead AI assumed the role of **V2 WF7 Workflow Agent**.
- **Goal:** Implement the missing "Extractor" workflow to process `Page` records and create `Contact` records.

### Step 2: Delegate Layer 1 (Data Model) Design
- **Action:** The WF7 Agent did not write the `Contact` model. It formally delegated the task to the **L1 Data Sentinel**.
- **Rationale:** The L1 Sentinel is the sole authority on database models, relationships, and ORM patterns.
- **Outcome:** The L1 Sentinel provided a 100% compliant model definition for `contact.py` and the necessary relationship hook for `page.py`. This design was approved and implemented without modification.

### Step 3: Delegate Layer 4 (Service) Design & The Course Correction
- **Action:** The WF7 Agent initially requested a new service design from the **L4 Arbiter**.
- **CRITICAL LESSON:** New information was discovered (`domain_content_service.py`). The initial request was immediately **retracted**. A new, more intelligent request was issued, asking the L4 Arbiter to design a service that *incorporated* the existing component.
- **Rationale:** This demonstrates the protocol's adaptability. We do not build what we already have. The L4 Arbiter is the authority on service composition.
- **Outcome:** The L4 Arbiter provided a compliant `PageCurationService` that correctly delegated content fetching, which was approved and implemented.

### Step 4: Delegate Layer 4 (Scheduler) Design
- **Action:** The WF7 Agent delegated the design of the background processor to the **L4 Arbiter**.
- **Rationale:** The L4 Arbiter is the authority on our gold-standard background processing pattern (dedicated schedulers using the `run_job_loop` SDK).
- **Outcome:** The L4 Arbiter provided a compliant `page_curation_scheduler.py` file, which was approved and implemented.

### Step 5: Delegate Layer 5 (Configuration) Design
- **Action:** The WF7 Agent delegated the task of integrating the new scheduler to the **L5 Config Conductor**.
- **Rationale:** The L5 Conductor is the sole authority on `settings.py` and application startup in `main.py`.
- **Outcome:** The L5 Conductor provided the exact code snippets for `settings.py` and `main.py` to register the scheduler, which were approved and implemented.

### Step 6: Delegate Layer 3 (Router) Design
- **Action:** The WF7 Agent delegated the design of the API endpoint to the **L3 Router Guardian**.
- **Rationale:** The L3 Guardian is the authority on API design, transaction boundaries, and the Dual-Status Update pattern.
- **Outcome:** The L3 Guardian provided a compliant V2 router with the `/api/v2/pages/status` endpoint, which was approved and implemented.

### Step 7: Final Integration
- **Action:** The WF7 Agent again delegated the final task of including the new router in the application to the **L5 Config Conductor**.
- **Rationale:** All changes to `main.py` are a Layer 5 concern.
- **Outcome:** The L5 Conductor provided the final import and `app.include_router()` statements, which were approved and implemented.

## 3. Guiding Principles for Future Work

This case study reveals the core principles that must guide all future V2 development.

1.  **Trust the Protocol:** The agent-based delegation system is not optional. It is the mandated process for ensuring quality and consistency.
2.  **Delegate, Do Not Assume:** A Workflow Agent's primary skill is orchestration and project management, not deep expertise in every layer. Always delegate design tasks to the appropriate Layer Guardian.
3.  **The Guardians are the Source of Truth:** The blueprints and advisories provided by the Layer Guardians are to be considered the architectural standard. Deviations are not permitted without a formal review and update to the underlying blueprint.
4.  **Document Your Work:** The creation of this very document is a meta-example of the protocol at work. The **L0 Chronicle**'s function is to preserve these lessons. All significant V2 efforts should be documented in a similar fashion.
5.  **Be Prepared to Course-Correct:** As demonstrated in Step 3, the discovery of new information should immediately trigger a re-evaluation of the current task. The protocol is flexible and intelligent; it is not a blind, linear path.

This compass now points the way. The successful implementation of WF7 is the blueprint for WF1 through WF6. Let us proceed with the same rigor and discipline.
